[1mdiff --git a/main.py b/main.py[m
[1mindex 6c53d1d..10a243a 100644[m
[1m--- a/main.py[m
[1m+++ b/main.py[m
[36m@@ -12,6 +12,7 @@[m [mimport json[m
 import nest_asyncio[m
 from datetime import datetime, timedelta[m
 import re[m
[32m+[m[32mfrom typing import Dict[m
 [m
 nest_asyncio.apply()[m
 # ================== –ë–õ–û–ö 1: –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è ==================[m
[36m@@ -116,8 +117,7 @@[m [mfrom egra import start_egra, handle_egra_answer, handle_final_button_press[m
 from profession import get_random_okved_and_commentary [m
 [m
 # ================== –ë–õ–û–ö 3.18: –ù–ê–°–¢–†–û–ô–ö–ê –†–ê–°–ß–ï–¢–ê –ù–ê–ì–†–£–ó–ö–ò –ë–û–¢–ê ==================[m
[31m-from statistics import init_db, get_total_messages_per_chat, get_activity_by_hour[m
[31m-from middlewares import StatisticsMiddleware[m
[32m+[m[32mimport statistics[m
 [m
 # ================== –ë–õ–û–ö 3.19: –ö–ê–õ–ï–ù–î–ê–†–¨ –î–ù–ï–ô –†–û–ñ–î–ï–ù–ò–Ø ==================[m
 from birthday_calendar import ([m
[36m@@ -132,49 +132,74 @@[m [mfrom birthday_calendar import ([m
 from broadcast import handle_broadcast_command, is_broadcast_command[m
         [m
 # ================== –ë–õ–û–ö 4: –•–≠–ù–î–õ–ï–†–´ ==================[m
[31m-@router.message(Command("stats"), F.from_user.id == ADMIN_ID)[m
[31m-async def get_stats_command(message: Message):[m
[31m-    chat_stats = await get_total_messages_per_chat()[m
[31m-    hour_stats = await get_activity_by_hour()[m
[31m-[m
[31m-    response_text = "üìä **–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ –±–æ—Ç—É**\n\n"[m
[31m-    response_text += "**–¢–æ–ø-5 —Å–∞–º—ã—Ö –∞–∫—Ç–∏–≤–Ω—ã—Ö —á–∞—Ç–æ–≤:**\n"[m
[31m-    [m
[31m-    # –°–æ—Ä—Ç–∏—Ä—É–µ–º –∏ –±–µ—Ä–µ–º —Ç–æ–ø-5[m
[31m-    sorted_chats = sorted(chat_stats.items(), key=lambda item: item[1], reverse=True)[:5][m
[31m-[m
[31m-    for chat_id, count in sorted_chats:[m
[31m-        response_text += f" ‚Ä¢ `ID {chat_id}`: {count} —Å–æ–æ–±—â–µ–Ω–∏–π\n"[m
[31m-[m
[31m-    response_text += "\n**–ê–∫—Ç–∏–≤–Ω–æ—Å—Ç—å –ø–æ —á–∞—Å–∞–º (UTC):**\n"[m
[31m-    if hour_stats:[m
[31m-        for hour in sorted(hour_stats.keys()):[m
[31m-            response_text += f" ‚Ä¢ `{hour:02d}:00 - {hour:02d}:59`: {hour_stats[hour]} —Å–æ–æ–±—â.\n"[m
[32m+[m[32mdef format_stats_message(stats: Dict[str, Dict], title: str) -> str:[m
[32m+[m[32m    """–í—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è –¥–ª—è –∫—Ä–∞—Å–∏–≤–æ–≥–æ —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏."""[m
[32m+[m[32m    parts = [f"üìä *{title}*"][m
[32m+[m[32m    if stats.get("groups"):[m
[32m+[m[32m        parts.append("\n*–ß–∞—Ç—ã:*")[m
[32m+[m[32m        sorted_groups = sorted(stats["groups"].items(), key=lambda item: item[1], reverse=True)[m
[32m+[m[32m        for chat_title, count in sorted_groups:[m
[32m+[m[32m            parts.append(f"  ‚Ä¢ `{chat_title}`: {count} —Å–æ–æ–±—â.")[m
     else:[m
[31m-        response_text += "–î–∞–Ω–Ω—ã—Ö –ø–æ —á–∞—Å–∞–º –ø–æ–∫–∞ –Ω–µ—Ç.\n"[m
[31m-[m
[31m-    await message.answer(response_text, parse_mode='Markdown')[m
[32m+[m[32m        parts.append("\n_–ù–µ—Ç –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏ –≤ –≥—Ä—É–ø–ø–æ–≤—ã—Ö —á–∞—Ç–∞—Ö._")[m
[32m+[m[32m    if stats.get("private"):[m
[32m+[m[32m        parts.append("\n*–õ–∏—á–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è:*")[m
[32m+[m[32m        sorted_private = sorted(stats["private"].items(), key=lambda item: item[1], reverse=True)[m
[32m+[m[32m        for user_display, count in sorted_private:[m
[32m+[m[32m            parts.append(f"  ‚Ä¢ `{user_display}`: {count} —Å–æ–æ–±—â.")[m
[32m+[m[32m    else:[m
[32m+[m[32m        parts.append("\n_–ù–µ—Ç –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏ –≤ –ª–∏—á–Ω—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏—è—Ö._")[m
[32m+[m[32m    return "\n".join(parts)[m
[32m+[m
[32m+[m[32m@router.message(F.text.lower() == "—Å—Ç–æ—Ç–∏—Å—Ç–∏–∫–∞", F.from_user.id == ADMIN_ID)[m
[32m+[m[32masync def cmd_stats_total(message: Message):[m
[32m+[m[32m    """–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∑–∞ –≤—Å–µ –≤—Ä–µ–º—è."""[m
[32m+[m[32m    processing_msg = await message.reply("‚è≥ –°–æ–±–∏—Ä–∞—é –∏ –æ–±–Ω–æ–≤–ª—è—é —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É... –ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –ø–æ–¥–æ–∂–¥–∏—Ç–µ.")[m
[32m+[m[32m    stats_data = await statistics.get_total_messages()[m
[32m+[m[32m    reply_text = format_stats_message(stats_data, "–û–±—â–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞")[m
[32m+[m[32m    await processing_msg.edit_text(reply_text, parse_mode="Markdown")[m
[32m+[m
[32m+[m[32m@router.message(F.text.lower() == "—Å—Ç–æ—Ç–∏—Å—Ç–∏–∫–∞ —Å—É—Ç–∫–∏", F.from_user.id == ADMIN_ID)[m
[32m+[m[32masync def cmd_stats_24h(message: Message):[m
[32m+[m[32m    """–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∑–∞ –ø–æ—Å–ª–µ–¥–Ω–∏–µ 24 —á–∞—Å–∞."""[m
[32m+[m[32m    processing_msg = await message.reply("‚è≥ –°–æ–±–∏—Ä–∞—é –∏ –æ–±–Ω–æ–≤–ª—è—é —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –∑–∞ —Å—É—Ç–∫–∏... –ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –ø–æ–¥–æ–∂–¥–∏—Ç–µ.")[m
[32m+[m[32m    stats_data = await statistics.get_messages_last_24_hours()[m
[32m+[m[32m    reply_text = format_stats_message(stats_data, "–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∑–∞ 24 —á–∞—Å–∞")[m
[32m+[m[32m    await processing_msg.edit_text(reply_text, parse_mode="Markdown")[m
[32m+[m
[32m+[m[32m@router.message(F.text.lower() == "—Å—Ç–æ—Ç–∏—Å—Ç–∏–∫–∞ —á–∞—Å", F.from_user.id == ADMIN_ID)[m
[32m+[m[32masync def cmd_stats_1h(message: Message):[m
[32m+[m[32m    """–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∑–∞ –ø–æ—Å–ª–µ–¥–Ω–∏–π —á–∞—Å."""[m
[32m+[m[32m    processing_msg = await message.reply("‚è≥ –°–æ–±–∏—Ä–∞—é –∏ –æ–±–Ω–æ–≤–ª—è—é —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –∑–∞ —á–∞—Å... –ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –ø–æ–¥–æ–∂–¥–∏—Ç–µ.")[m
[32m+[m[32m    stats_data = await statistics.get_messages_last_hour()[m
[32m+[m[32m    reply_text = format_stats_message(stats_data, "–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∑–∞ —á–∞—Å")[m
[32m+[m[32m    await processing_msg.edit_text(reply_text, parse_mode="Markdown")[m
 [m
 @router.message(CommandStart())[m
 async def process_start_command(message: types.Message):[m
[32m+[m[32m    await statistics.log_activity(message)[m
     await message.reply("–Ø –ø–∏–¥–æ—Ä–∞—Å")[m
 [m
 @router.message(lambda message: message.text is not None and message.text.lower() == "–æ—á–∏—Å—Ç–∫–∞" and message.from_user.id not in BLOCKED_USERS)[m
 async def process_clear_command(message: types.Message):[m
[32m+[m[32m    await statistics.log_activity(message)[m
     user_id = message.from_user.id[m
     conversation_history[user_id] = [][m
     await message.reply("–°–º—ã—Ç–æ –≤—Å—ë –≥–æ–≤–Ω–æ")[m
 [m
 @router.message(lambda message: message.text and message.text.lower() == "—á–æ—É–º–µ–µ—à" and message.from_user.id not in BLOCKED_USERS)[m
 async def handle_chooumeesh(message: types.Message):[m
[32m+[m[32m    await statistics.log_activity(message)[m
     await message.reply(HELP_TEXT)[m
     [m
 @router.message(lambda message: message.text and is_broadcast_command(message.text) and message.from_user.id not in BLOCKED_USERS)[m
 async def handle_broadcast(message: types.Message):[m
[32m+[m[32m    await statistics.log_activity(message)[m
     await handle_broadcast_command(message)[m
 [m
 @router.message(lambda message: message.text and message.text.lower().startswith("—É–ø—É–ø–∞ –≤—ã–π–¥–∏ –∏–∑ "))[m
 async def leave_chat(message: types.Message):[m
[32m+[m[32m    await statistics.log_activity(message)[m
     if message.from_user.id != ADMIN_ID:[m
         await message.reply("–ï—â–µ —á–æ —Å–¥–µ–ª–∞—Ç—å?")[m
         return[m
[36m@@ -183,6 +208,7 @@[m [masync def leave_chat(message: types.Message):[m
 [m
 @router.message(lambda message: message.text and message.text.lower() == "–æ–±–Ω–æ–≤–∏—Ç—å —á–∞—Ç—ã")[m
 async def update_all_chats(message: types.Message):[m
[32m+[m[32m    await statistics.log_activity(message)[m
     if message.from_user.id != ADMIN_ID:[m
         await message.reply("–ò–¥–∏ –Ω–∞—Ö—É–π, —É —Ç–µ–±—è –Ω–µ—Ç –ø—Ä–∞–≤ –Ω–∞ —ç—Ç–æ.")[m
         return[m
[36m@@ -190,12 +216,14 @@[m [masync def update_all_chats(message: types.Message):[m
 [m
 @router.message(lambda message: message.text and message.text.lower() == "–≥–¥–µ —Å–∏–¥–∏—à—å")[m
 async def handle_where_sits(message: types.Message):[m
[32m+[m[32m    await statistics.log_activity(message)[m
     global chat_list[m
     response = get_chats_list(message.chat.id, message.chat.title, message.chat.username)[m
     await message.reply(response)[m
 [m
 @router.message(lambda message: message.text and message.text.lower() == "–æ—Ç–∫–ª—é—á–∏ —Å–º—Å")[m
 async def disable_sms(message: types.Message):[m
[32m+[m[32m    await statistics.log_activity(message)[m
     chat_id = str(message.chat.id)[m
     user_id = message.from_user.id  # ID –æ—Ç–ø—Ä–∞–≤–∏—Ç–µ–ª—è[m
     response = await process_disable_sms(chat_id, user_id, bot)[m
[36m@@ -203,6 +231,7 @@[m [masync def disable_sms(message: types.Message):[m
 [m
 @router.message(lambda message: message.text and message.text.lower() == "–≤–∫–ª—é—á–∏ —Å–º—Å")[m
 async def enable_sms(message: types.Message):[m
[32m+[m[32m    await statistics.log_activity(message)[m
     chat_id = str(message.chat.id)[m
     user_id = message.from_user.id[m
     response = await process_enable_sms(chat_id, user_id, bot)[m
[36m@@ -210,11 +239,13 @@[m [masync def enable_sms(message: types.Message):[m
 [m
 @router.message(lambda message: message.text and (message.text.lower().startswith("—Å–º—Å ") or message.text.lower().startswith("–º–º—Å ")))[m
 async def check_sms_mms_permission(message: types.Message):[m
[32m+[m[32m    await statistics.log_activity(message)[m
     chat_id = str(message.chat.id)[m
     await process_check_sms_mms_permission(chat_id, message)[m
 [m
 @router.message(lambda message: message.text and message.text.lower().startswith("—Å–º—Å "))[m
 async def handle_send_sms(message: types.Message):[m
[32m+[m[32m    await statistics.log_activity(message)[m
     from SMS_settings import process_send_sms[m
     global chat_list[m
     await process_send_sms(message, chat_list, bot, sms_disabled_chats)[m
[36m@@ -222,11 +253,13 @@[m [masync def handle_send_sms(message: types.Message):[m
 @router.message(lambda message: (message.text and message.text.lower().startswith("–º–º—Å ")) or [m
                                 (message.caption and message.caption.lower().startswith("–º–º—Å ")))[m
 async def handle_send_mms(message: types.Message):[m
[32m+[m[32m    await statistics.log_activity(message)[m
     from SMS_settings import process_send_mms[m
     await process_send_mms(message, chat_list, bot, sms_disabled_chats)[m
 [m
 @router.message(lambda message: message.text and message.text.lower() == "–º–æ–π –ª–µ–∫—Å–∏–∫–æ–Ω")[m
 async def handle_my_lexicon(message: types.Message):[m
[32m+[m[32m    await statistics.log_activity(message)[m
     random_action = random.choice(actions)[m
     await message.bot.send_chat_action(chat_id=message.chat.id, action=random_action)[m
     user_id = message.from_user.id[m
[36m@@ -235,6 +268,7 @@[m [masync def handle_my_lexicon(message: types.Message):[m
 [m
 @router.message(lambda message: message.text and message.text.lower() == "–ª–µ–∫—Å–∏–∫–æ–Ω —á–∞—Ç")[m
 async def handle_chat_lexicon(message: types.Message):[m
[32m+[m[32m    await statistics.log_activity(message)[m
     random_action = random.choice(actions)[m
     await message.bot.send_chat_action(chat_id=message.chat.id, action=random_action)[m
     response_text = await process_chat_lexicon(message)[m
[36m@@ -242,6 +276,7 @@[m [masync def handle_chat_lexicon(message: types.Message):[m
     [m
 @router.message(lambda message: message.text and message.text.lower().startswith("–ª–µ–∫—Å–∏–∫–æ–Ω "))[m
 async def handle_user_lexicon(message: types.Message):[m
[32m+[m[32m    await statistics.log_activity(message)[m
     random_action = random.choice(actions)[m
     await message.bot.send_chat_action(chat_id=message.chat.id, action=random_action)[m
     username_or_name = message.text[len("–ª–µ–∫—Å–∏–∫–æ–Ω "):].strip()[m
[36m@@ -252,6 +287,7 @@[m [masync def handle_user_lexicon(message: types.Message):[m
 [m
 @router.message(F.text.lower() == "–º–æ—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞")[m
 async def show_personal_stats(message: types.Message):[m
[32m+[m[32m    await statistics.log_activity(message)[m
     random_action = random.choice(actions)[m
     await message.bot.send_chat_action(chat_id=message.chat.id, action=random_action)[m
     logging.info(f"–ö–æ–º–∞–Ω–¥–∞ '–º–æ—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞' –≤—ã–∑–≤–∞–Ω–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º {message.from_user.id} –≤ —á–∞—Ç–µ {message.chat.id}")[m
[36m@@ -262,6 +298,7 @@[m [masync def show_personal_stats(message: types.Message):[m
 [m
 @router.message(F.text.lower() == "—Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ —á–∞—Ç")[m
 async def show_chat_stats(message: types.Message):[m
[32m+[m[32m    await statistics.log_activity(message)[m
     await message.bot.send_chat_action(chat_id=message.chat.id, action=random.choice(actions))[m
     report = await generate_chat_stats_report(str(message.chat.id))[m
     reply_text = report if report else "–í —ç—Ç–æ–º —á–∞—Ç–µ –Ω–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã—Ö —Å—Ç–∞—Ç–∏—Å—Ç–∏—á–µ—Å–∫–∏—Ö –¥–∞–Ω–Ω—ã—Ö."[m
[36m@@ -269,10 +306,12 @@[m [masync def show_chat_stats(message: types.Message):[m
 [m
 @router.message(lambda message: message.text and message.text.lower() == "—á—Ç–æ –∑–∞ —á–∞—Ç")[m
 async def handle_chat_profile(message: types.Message):[m
[32m+[m[32m    await statistics.log_activity(message)[m
     await process_chat_profile(message)[m
 [m
 @router.message(lambda message: message.text and message.text.lower() == "–∫—Ç–æ —è")[m
 async def handle_user_profile(message: types.Message):[m
[32m+[m[32m    await statistics.log_activity(message)[m
     random_action = random.choice(actions)[m
     await message.bot.send_chat_action(chat_id=message.chat.id, action=random_action)[m
     user_id = message.from_user.id[m
[36m@@ -281,6 +320,7 @@[m [masync def handle_user_profile(message: types.Message):[m
 [m
 @router.message(lambda message: message.text and message.text.lower().startswith("–ø–∞—Ä–æ–¥–∏—è"))[m
 async def handle_parody(message: types.Message):[m
[32m+[m[32m   await statistics.log_activity(message)[m
    random_action = random.choice(actions)[m
    await message.bot.send_chat_action(chat_id=message.chat.id, action=random_action)[m
    chat_id = message.chat.id  # –û–≥—Ä–∞–Ω–∏—á–∏–≤–∞–µ–º –≤—ã–±–æ—Ä —Ñ—Ä–∞–∑ —ç—Ç–∏–º —á–∞—Ç–æ–º[m
[36m@@ -288,6 +328,7 @@[m [masync def handle_parody(message: types.Message):[m
 [m
 @router.message(F.text.lower().contains("–≤–∏–∫—Ç–æ—Ä–∏–Ω–∞"))[m
 async def start_quiz(message: Message, bot: Bot):[m
[32m+[m[32m    await statistics.log_activity(message)[m
     random_action = random.choice(actions)[m
     await message.bot.send_chat_action(chat_id=message.chat.id, action=random_action)[m
     processing_msg = await message.reply("–ì–µ–Ω–µ—Ä–∏—Ä—É—é –≤–∞–ø—Ä–æ—Å–∏–∫–∏...")[m
[36m@@ -296,29 +337,26 @@[m [masync def start_quiz(message: Message, bot: Bot):[m
     if not success:[m
         await message.reply(error_message)[m
 [m
[31m-# ================== –ù–û–í–û–ï: –•—ç–Ω–¥–ª–µ—Ä –¥–ª—è –∫–æ–º–∞–Ω–¥—ã "–µ–≥—Ä–∞" ==================[m
 @router.message(F.text.lower() == "–µ–≥—Ä–∞")[m
 async def egra_command_handler(message: types.Message):[m
[32m+[m[32m    await statistics.log_activity(message)[m
     await start_egra(message, bot)[m
 [m
[31m-# ================== –ò–ó–ú–ï–ù–ï–ù–û: –£–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω—ã–π –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –æ–ø—Ä–æ—Å–æ–≤ ==================[m
 @router.poll_answer()[m
 async def handle_poll_answers(poll_answer: PollAnswer, bot: Bot):[m
[31m-    # –°–Ω–∞—á–∞–ª–∞ –ø—ã—Ç–∞–µ–º—Å—è –æ–±—Ä–∞–±–æ—Ç–∞—Ç—å –∫–∞–∫ –æ—Ç–≤–µ—Ç –≤ "–µ–≥—Ä–µ"[m
[31m-    # –§—É–Ω–∫—Ü–∏—è –≤–µ—Ä–Ω–µ—Ç True, –µ—Å–ª–∏ –æ—Ç–≤–µ—Ç –±—ã–ª —É—Å–ø–µ—à–Ω–æ –æ–±—Ä–∞–±–æ—Ç–∞–Ω[m
[32m+[m[32m    await statistics.log_activity(message)[m
     is_egra_handled = await handle_egra_answer(poll_answer, bot)[m
[31m-    [m
[31m-    # –ï—Å–ª–∏ —ç—Ç–æ –±—ã–ª –Ω–µ –æ—Ç–≤–µ—Ç –≤ "–µ–≥—Ä–µ", –ø—ã—Ç–∞–µ–º—Å—è –æ–±—Ä–∞–±–æ—Ç–∞—Ç—å –∫–∞–∫ –æ—Ç–≤–µ—Ç –≤ –≤–∏–∫—Ç–æ—Ä–∏–Ω–µ[m
     if not is_egra_handled:[m
         await process_poll_answer(poll_answer, bot)[m
 [m
[31m-# ================== –ù–û–í–û–ï: –•—ç–Ω–¥–ª–µ—Ä –¥–ª—è –Ω–∞–∂–∞—Ç–∏—è –∏–Ω–ª–∞–π–Ω-–∫–Ω–æ–ø–∫–∏ –≤ –∏–≥—Ä–µ ==================[m
 @router.callback_query(F.data == "egra_final_choice")[m
 async def egra_callback_handler(callback_query: types.CallbackQuery):[m
[32m+[m[32m    await statistics.log_activity(message)[m
     await handle_final_button_press(callback_query, bot)[m
 [m
 @router.message(lambda message: message.text and message.text.lower() in CHANNEL_SETTINGS.keys())[m
 async def send_random_media(message: types.Message):[m
[32m+[m[32m    await statistics.log_activity(message)[m
     await process_channel_command(message, CHANNEL_SETTINGS)[m
 [m
 @router.message(lambda message: [m
[36m@@ -330,15 +368,18 @@[m [masync def send_random_media(message: types.Message):[m
 [m
 @router.message(F.text.lower() == "–∫–µ–º —Å—Ç–∞—Ç—å") # <--- –î–û–ë–ê–í–¨–¢–ï –≠–¢–û–¢ –•–≠–ù–î–õ–ï–†[m
 async def choose_profession_command(message: types.Message):[m
[32m+[m[32m    await statistics.log_activity(message)[m
     await get_random_okved_and_commentary(message)[m
     [m
 async def handle_name_info(message: types.Message):[m
[32m+[m[32m    await statistics.log_activity(message)[m
     random_action = random.choice(actions)[m
     success, response = await process_name_info(message)[m
     await message.reply(response)[m
 [m
 @router.message(lambda message: message.text and message.text.lower().startswith("–Ω–∞–π–¥–∏") and message.from_user.id not in BLOCKED_USERS)[m
 async def handle_image_search(message: Message):[m
[32m+[m[32m    await statistics.log_activity(message)[m
     random_action = random.choice(actions)[m
     query = message.text[len("–Ω–∞–π–¥–∏"):].strip()[m
     success, response_message, image_data = await process_image_search(query)[m
[36m@@ -349,12 +390,14 @@[m [masync def handle_image_search(message: Message):[m
 [m
 @router.message(lambda message: message.text and message.text.lower() in queries and message.from_user.id not in BLOCKED_USERS)[m
 async def universal_handler(message: types.Message):[m
[32m+[m[32m    await statistics.log_activity(message)[m
     keyword = message.text.lower()[m
     query, temp_img_path, error_msg = queries[keyword][m
     await handle_message(message, query, temp_img_path, error_msg)[m
 [m
 @router.message(lambda message: message.text and message.text.lower().replace(" ", "") == "–∫–æ—Ç–æ–≥–∏—Ñ" and message.from_user.id not in BLOCKED_USERS)[m
 async def send_kotogif(message: types.Message):[m
[32m+[m[32m    await statistics.log_activity(message)[m
     random_action = random.choice(actions)[m
     await message.bot.send_chat_action(chat_id=message.chat.id, action=random_action)[m
     await message.reply("–©–∞ —â–∞")[m
[36m@@ -375,6 +418,7 @@[m [masync def send_kotogif(message: types.Message):[m
     ) and message.from_user.id not in BLOCKED_USERS[m
 )[m
 async def handle_audio_description(message: types.Message):[m
[32m+[m[32m    await statistics.log_activity(message)[m
     random_action = random.choice(actions)[m
     await message.bot.send_chat_action(chat_id=message.chat.id, action=random_action)[m
     processing_msg = await message.reply("–°–ª—É—à–æ—é...")[m
[36m@@ -393,6 +437,7 @@[m [masync def handle_audio_description(message: types.Message):[m
     ) and message.from_user.id not in BLOCKED_USERS[m
 )[m
 async def handle_video_description(message: types.Message):[m
[32m+[m[32m    await statistics.log_activity(message)[m
     random_action = random.choice(actions)[m
     await message.bot.send_chat_action(chat_id=message.chat.id, action=random_action)[m
     processing_msg = await message.reply("–°–º–∞—Ç—Ä—é...")[m
[36m@@ -412,6 +457,7 @@[m [masync def handle_video_description(message: types.Message):[m
     ) and message.from_user.id not in BLOCKED_USERS[m
 )[m
 async def handle_image_whatisthere(message: types.Message):[m
[32m+[m[32m    await statistics.log_activity(message)[m
     random_action = random.choice(actions)[m
     await message.bot.send_chat_action(chat_id=message.chat.id, action=random_action)[m
  